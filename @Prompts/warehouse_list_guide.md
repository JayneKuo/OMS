# Warehouse List 功能需求文档

## 1. 页面概述

### 1.1 基本信息
- 页面名称：Warehouse List
- 路由路径：`/warehouse/list`
- 功能描述：管理仓库信息及其WMS版本分配
- 页面位置：主菜单 Warehouse 下的子菜单

### 1.2 页面布局
- 顶部标题区：包含页面标题和操作按钮
- 主体列表区：展示仓库信息的表格
- 底部分页区：分页控件

### 1.3 应用场景

#### 1.3.1 Sales Order分仓应用
- **功能描述**：
  - 用于Sales Order系统的仓库分配
  - 根据warehouse的WMS版本确定订单处理系统
  - 作为Sales Order生单的必要前置条件

- **业务规则**：
  - 必须选择已配置WMS版本的仓库
  - 未配置WMS版本的仓库不可用于分仓
  - 系统自动根据WMS版本路由订单到对应系统

#### 1.3.2 库存查询应用
- **WMS V1库存查询**：
  - 系统：WISE系统
  - 查询路径：直接查询WISE系统库存数据
  - 数据同步：实时查询

- **WMS V2库存查询**：
  - 系统：Inventory Service
  - 查询路径：通过Inventory Service API查询
  - 数据同步：准实时更新

- **查询规则**：
  - 系统根据仓库WMS版本自动路由到对应查询服务
  - 查询结果格式统一，对上层应用透明

#### 1.3.3 仓库可用性控制
- **基本规则**：
  - 未设置WMS版本的仓库状态为不可用
  - 不可用仓库无法用于：
    - Sales Order分仓
    - 库存查询
    - 其他依赖WMS的业务操作

- **状态管理**：
  - 实时监控仓库WMS版本状态
  - 自动更新仓库可用性状态
  - 提供仓库状态变更通知

## 2. 功能模块

### 2.1 顶部操作区
#### 2.1.1 页面标题
- 主标题：Warehouse List
- 副标题：Manage warehouses and their WMS version assignments

#### 2.1.2 操作按钮
- 添加仓库按钮：
  - 类型：主要按钮（Primary）
  - 图标：Plus
  - 文本：Add Warehouse
- 批量配置按钮：
  - 类型：次要按钮（Plain Primary）
  - 图标：Setting
  - 文本：Batch Configure
  - 功能：打开批量配置对话框
- 刷新按钮：
  - 类型：默认按钮（Default）
  - 图标：Refresh
  - 文本：Refresh
  - 功能：刷新列表数据

### 2.2 仓库列表表格
#### 2.2.1 基本配置
- 表格属性：
  - 边框：显示
  - 条纹：启用
  - 行键值：rank
  - 可拖拽排序
  - 支持多选

#### 2.2.2 列配置
1. **拖拽图标列**
   - 宽度：50px
   - 内容：拖拽操作图标
   - 样式：居中对齐

2. **RANK列**
   - 宽度：80px
   - 对齐：居中
   - 内容：序号
   - 排序：通过拖拽自动更新

3. **基本信息列**
   - WAREHOUSE (宽度：150px)
   - ACCOUNTING CODE (宽度：180px)
   - CITY (宽度：120px)
   - STATE (宽度：100px)
   - COUNTRY (宽度：120px)
   - ADDRESS 1 (最小宽度：200px)
   - ZIP CODE (宽度：120px)

4. **联系人信息列**
   - CONTACT NAME (宽度：150px)
   - CONTACT EMAIL (宽度：180px)
   - CONTACT PHONE (宽度：150px)

5. **WMS版本列**
   - 宽度：150px
   - 类型：单选下拉框
   - 初始值：空（未设置）
   - 选项：
     - WMS V1 (value: 'V1')
     - WMS V2 (value: 'V2')
   - 业务影响：
     - 影响仓库可用性
     - 决定库存查询路径
     - 影响订单分仓逻辑

### 2.3 分页控件
- 页码导航
- 每页条数选择：[10, 20, 50, 100]
- 总条数显示
- 布局：total, sizes, prev, pager, next

## 3. 交互逻辑

### 3.1 拖拽排序
1. **触发条件**：
   - 通过拖拽图标进行拖拽
   - 仅支持垂直方向拖拽

2. **视觉反馈**：
   - 拖拽过程中行半透明显示
   - 目标位置高亮提示
   - 拖拽把手hover时颜色变化

3. **排序逻辑**：
   - 拖拽结束后自动更新所有行的rank值
   - rank值从1开始连续编号
   - 自动保存新的排序结果

### 3.2 WMS版本管理
1. **版本选择**：
   - 可选择 Unassigned/V1/V2
   - 根据仓库的availableVersions控制可选项
   - 不可用版本显示禁用状态

2. **初始化逻辑**：
   - 页面加载时，第一个仓库自动尝试关联V1版本
   - 初始化失败时自动设置为Unassigned
   - 显示失败提示信息

3. **版本变更处理**：
   - 切换版本时显示加载状态
   - 成功/失败时显示对应提示信息
   - 失败时自动回退到Unassigned状态
   - 取消关联时直接设置为Unassigned

4. **业务联动处理**：
   - 版本变更时触发：
     - 仓库可用性状态更新
     - 相关业务系统通知
     - 缓存清理
   - 数据同步处理：
     - 同步更新到关联业务系统
     - 触发相关缓存刷新
   - 状态检查：
     - 定期检查WMS连接状态
     - 自动标记异常仓库

### 3.3 数据刷新
- 点击刷新按钮重新加载数据
- 切换分页时重新加载数据
- 修改每页条数时重新加载数据

### 3.4 批量配置功能

#### 3.4.1 选择操作
- 支持表格多选
- 显示已选择仓库数量
- 选择为空时批量配置按钮提示选择仓库

#### 3.4.2 批量配置对话框
- 标题：Batch WMS Configuration
- 宽度：500px
- 显示内容：
  - 已选择仓库数量
  - WMS版本选择下拉框
  - 当选中已配置仓库时显示警告提示

#### 3.4.3 配置选项
- WMS版本选择：
  - WMS V1
  - WMS V2
- 按钮操作：
  - 取消：关闭对话框
  - 应用配置：
    - 未选择版本时禁用
    - 无选中仓库时禁用
    - 点击时显示加载状态

#### 3.4.4 配置处理流程
1. **前置验证**：
   - 检查是否有选中的仓库
   - 验证是否选择了WMS版本

2. **执行配置**：
   - 显示加载状态
   - 批量更新选中仓库的WMS版本
   - 更新仓库状态信息：
     - 设置可用状态
     - 更新状态检查时间
     - 更新连接状态

3. **结果处理**：
   - 成功：
     - 显示成功消息
     - 关闭对话框
     - 清空表单
   - 失败：
     - 显示错误提示
     - 保持对话框开启
     - 允许重试

## 4. 数据结构

### 4.1 仓库数据模型
```typescript
interface Warehouse {
  rank: number                    // 排序序号
  warehouse: string              // 仓库名称
  accountingCode: string         // 会计代码
  city: string                  // 城市
  state: string                 // 州/省
  country: string               // 国家
  address1: string              // 地址
  zipCode: string              // 邮编
  contactName: string          // 联系人姓名
  contactEmail: string         // 联系人邮箱
  contactPhone: string         // 联系人电话
  wmsVersion?: 'V1' | 'V2' | null  // WMS版本
  isAvailable: boolean            // 仓库是否可用
  lastStatusCheck: Date          // 最后状态检查时间
  statusCheckResult?: {          // 状态检查结果
    connected: boolean          // 连接状态
    lastSuccessful: Date       // 最后成功连接时间
    errorMessage?: string      // 错误信息
  }
}

// 新增WMS系统配置接口
interface WmsSystemConfig {
  version: 'V1' | 'V2'
  system: 'WISE' | 'INVENTORY_SERVICE'
  apiEndpoint: string
  timeout: number
  retryAttempts: number
}
```

## 5. 样式规范

### 5.1 颜色规范
- 背景色：var(--bg-dark)
- 表头背景：var(--bg-darker)
- 文本颜色：
  - 主要文本：var(--text-primary)
  - 次要文本：var(--text-secondary)
- 边框颜色：var(--border-color)

### 5.2 尺寸规范
- 页面内边距：32px
- 标题文字：32px
- 副标题文字：14px
- 按钮间距：12px
- 分页区上边距：20px

### 5.3 交互样式
- 拖拽行样式：
  - 正常状态：cursor: move
  - 拖拽中：半透明效果
  - 目标位置：高亮背景色
- 拖拽图标：
  - 正常状态：次要文本颜色
  - hover状态：主要文本颜色

## 6. 错误处理

### 6.1 WMS版本操作
- 初始化失败：
  - 显示错误提示
  - 自动设置为Unassigned状态
- 版本切换失败：
  - 显示具体错误信息
  - 自动回退到Unassigned状态
- 权限验证失败：
  - 显示权限错误提示
  - 保持原有状态

### 6.2 排序操作
- 排序保存失败：
  - 显示错误提示
  - 保持新的排序状态
  - 不回退到原有顺序

### 6.3 业务集成错误
- **WMS连接错误**：
  - 自动重试连接
  - 标记仓库为不可用
  - 发送系统告警
  - 记录错误日志

- **数据同步错误**：
  - 触发同步重试机制
  - 保持数据一致性
  - 记录同步失败详情

- **状态检查错误**：
  - 执行降级策略
  - 使用缓存数据
  - 通知系统管理员

- **批量配置错误**：
  - 记录失败的仓库列表
  - 支持部分成功的情况
  - 提供失败原因详情
  - 支持配置回滚

## 7. 性能优化

### 7.1 列表优化
- 使用虚拟滚动（大数据量时）
- 按需加载数据
- 分页处理

### 7.2 操作优化
- 防抖处理：
  - 刷新按钮点击
  - 分页切换
- 节流处理：
  - 拖拽排序保存
  - WMS版本切换

## 8. 注意事项

1. WMS版本变更需要后端配合验证
2. 排序功能需要考虑并发操作的处理
3. 大量数据时需要考虑分页性能
4. 需要适配不同屏幕尺寸
5. 考虑网络异常情况的处理
6. WMS版本变更需要考虑业务连续性
7. 需要实现完整的监控和告警机制
8. 考虑不同WMS系统的性能差异
9. 实现数据同步的重试和降级机制
10. 确保系统状态的实时性和准确性
11. 批量配置时需要考虑性能影响
12. 需要处理并发配置的冲突情况
13. 批量操作需要添加操作日志

## 9. 监控指标

### 9.1 系统性能指标
- WMS响应时间
- 库存查询延迟
- 系统可用性统计
- 错误率监控

### 9.2 业务指标
- 仓库使用率
- 版本切换频率
- 异常状态统计
- 系统连接状态

## 10. 集成测试

### 10.1 WMS集成测试
- V1系统连接测试
- V2系统连接测试
- 故障转移测试
- 性能基准测试

### 10.2 业务流程测试
- Sales Order分仓测试
- 库存查询路由测试
- 状态变更测试
- 并发操作测试
- 批量配置测试：
  - 多选功能测试
  - 批量更新测试
  - 并发配置测试
  - 错误处理测试 